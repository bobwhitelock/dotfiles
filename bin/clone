#!/usr/bin/env python3

import os
import subprocess
import sys
from pathlib import Path


def main():
    repo_identifier = sys.argv[1]

    owner_raw = os.path.basename(os.path.dirname(repo_identifier))
    owner = owner_raw.split(":")[-1]
    base_name = os.path.basename(repo_identifier)
    name = base_name.removesuffix(".git")

    repo = f"{owner}/{name}"

    owner_path = Path(os.environ["SRC"]) / owner
    owner_path.mkdir(parents=True, exist_ok=True)

    if not (owner_path / name).is_dir():
        subprocess.run(["gh", "repo", "clone", repo], cwd=owner_path, check=True)

    subprocess.run(["add_window", "--vim-pane", name], check=True)


if __name__ == "__main__":
    main()
