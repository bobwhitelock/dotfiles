#!/usr/bin/env python3

""" Output data in 1-to-many Parquet files passed as arguments, in CSV format.

    It is assumed these files all contain the same columns; if they do not then
    the output will likely be nonsensical.
"""

import sys

import pandas


def main():
    for file_number, parquet_file in enumerate(sys.argv[1:]):
        dataframe = pandas.read_parquet(parquet_file)
        print_header = file_number == 0
        try:
            dataframe.to_csv(sys.stdout, index=False, header=print_header)
        except BrokenPipeError:
            # This will happen if only part of the result needs to be piped
            # somewhere, e.g. `parquet_to_csv $file | head`.
            sys.stderr.buffer.write(b'\nAborting...\n')


if __name__ == '__main__':
    main()
